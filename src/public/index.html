<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Seller Dashboard</title>
  <link rel="stylesheet" href="/styles.css">
  <script src="/socket.io/socket.io.js"></script>
  <style>
    /* Simple styling for clarity */
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .container {
      display: flex;
      gap: 20px;
    }
    .order-form, .notifications {
      width: 50%;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input, button {
      display: block;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <h1>Seller Dashboard</h1>
  <div class="container">
    <div class="order-form">
      <h2>Create Order</h2>
      <form id="orderForm">
        <label for="user">User Email:</label>
        <input type="email" id="user" name="user" required placeholder="Enter user email">

        <label for="products">Products (JSON format):</label>
        <input type="text" id="products" name="products" required placeholder='Format: [{"productId":"product1", "quantity":2}, {"productId":"product2", "quantity":1}]'>
        
        <label for="totalAmount">Total Amount ($):</label>
        <input type="number" id="totalAmount" name="totalAmount" required placeholder="Enter total amount">

        <button type="submit">Create Order</button>
      </form>
    </div>
    <div class="notifications">
      <h2>Notifications</h2>
      <ul id="notificationList"></ul>
    </div>
    <ul id="data"></ul
  </div>
  <script>
    const socket = io();

    document.getElementById('orderForm').addEventListener('submit', async (event) => {
      event.preventDefault();
      
      const user = document.getElementById('user').value;
      const products = document.getElementById('products').value;
      const totalAmount = document.getElementById('totalAmount').value;

      // Parse products string into JSON
      let productsArray;
      try {
        productsArray = JSON.parse(products);
      } catch (error) {
        alert('Invalid products format. Use the format: [{"productId":"product1", "quantity":2}, {"productId":"product2", "quantity":1}]');
        return;
      }
      
      const response = await fetch('/orders', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ user, products: productsArray, totalAmount })
      });

      console.log(response);
      if (response.ok) {
        document.getElementById('orderForm').reset();
        alert('Order created successfully');
      } else {
        alert('Failed to create order');
      }
    });


    socket.on('notifySeller', (data) => {
      const notificationList = document.getElementById('notificationList');
      const listItem = document.createElement('li');
      listItem.textContent = `New order received from ${{
        receiver:data.receiver,
        subject:data.subject,
        message:data.message,
        entityId: data.entityId.productWishId,
        image:data.productImage,
      }}`;
      notificationList.appendChild(listItem);
    });


    // Listen for 'liveData' event from server
    socket.on('liveData', (data) => {
        const item = document.createElement('li');
        item.textContent = `Time: ${data.timestamp}, Value: ${data.value.toFixed(2)}`;
        document.getElementById('data').appendChild(item);
    })
  </script>
</body>
</html>
